[tox]
envlist = 
    py{37,38,39,310,311,312}-nagios{446,447,448,449,4410}
    lint
    type
    docs
    coverage
isolated_build = True
skip_missing_interpreters = True

[gh-actions]
python =
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312

[testenv]
deps =
    pytest>=7.3.1
    pytest-cov>=4.1.0
    pytest-mock>=3.10.0
    httpx>=0.24.0
    mock>=5.0.0
commands =
    # Run tests with pytest
    nagios446: pytest {posargs:tests} --nagios-version=4.4.6 -v --junitxml=test-reports/junit-{envname}.xml
    nagios447: pytest {posargs:tests} --nagios-version=4.4.7 -v --junitxml=test-reports/junit-{envname}.xml
    nagios448: pytest {posargs:tests} --nagios-version=4.4.8 -v --junitxml=test-reports/junit-{envname}.xml
    nagios449: pytest {posargs:tests} --nagios-version=4.4.9 -v --junitxml=test-reports/junit-{envname}.xml
    nagios4410: pytest {posargs:tests} --nagios-version=4.4.10 -v --junitxml=test-reports/junit-{envname}.xml
setenv =
    PYTHONPATH = {toxinidir}
    COVERAGE_FILE = .coverage.{envname}

[testenv:lint]
deps =
    black>=23.3.0
    isort>=5.12.0
    flake8>=6.0.0
    pylint>=2.17.0
    pydocstyle>=6.3.0
commands =
    black --check src tests
    isort --check-only --profile black src tests
    flake8 src tests
    pylint src tests
    pydocstyle src

[testenv:type]
deps =
    mypy>=1.3.0
    types-mock>=5.0.0.1
commands =
    mypy src tests

[testenv:docs]
deps =
    sphinx>=7.0.0
    sphinx-rtd-theme>=1.2.1
    docstr-coverage>=2.2.0
commands =
    sphinx-build -b html docs/source docs/build/html
    docstr-coverage src --fail-under=95

[testenv:coverage]
deps =
    pytest>=7.3.1
    pytest-cov>=4.1.0
commands =
    pytest --cov=src --cov-report=xml --cov-report=term {posargs:tests}

[flake8]
max-line-length = 100
exclude = .tox,*.egg,build,data
select = E,W,F

[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
python_classes = Test*
markers =
    nagios446: tests for Nagios 4.4.6
    nagios447: tests for Nagios 4.4.7
    nagios448: tests for Nagios 4.4.8
    nagios449: tests for Nagios 4.4.9
    nagios4410: tests for Nagios 4.4.10
    unit: unit tests
    integration: integration tests
